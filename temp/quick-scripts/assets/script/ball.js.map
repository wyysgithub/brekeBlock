{"version":3,"sources":["ball.js"],"names":["cc","Class","extends","Component","properties","speedPercent","areaPercent","attack","ballNum","onLoad","baffle","find","gameMain","getComponent","waiting","msg","timeout","Label","active","userInfo","ballNumLabel","levelBlockNode","RigidBody","setArea","setSpeed","linearVelocity","p","node","width","height","physicsCircle","PhysicsCircleCollider","radius","apply","resetPosition","string","ballRun","_x","x","_y","setPosition","v2","num","schedule","bind","scheduleOnce","getBlockNum","surplusBlock","childrenCount","passLevel","start","update","dt","y","gameOver","onBeginContact","contact","selfCollider","otherCollider","onEndContact","groupIndex","defense","destroy","onPreSolve","onPostSolve","onCollisionStay","other","self","attackGrow","attach","speedGrow","percent","areaGrow"],"mappings":"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","file":"ball.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        speedPercent: 1,\r\n        areaPercent: 1,\r\n        attack: 1,\r\n        ballNum: 3\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n        this.baffle = cc.find(\"UI_ROOT/baffle\");\r\n        this.gameMain = cc.find(\"UI_ROOT\").getComponent(\"gameMain\");\r\n        this.waiting = cc.find(\"UI_ROOT/waiting\");\r\n        // 发球倒计时\r\n        this.msg = cc.find(\"UI_ROOT/msg\")\r\n        this.timeout = cc.find(\"UI_ROOT/msg/timeout\").getComponent(cc.Label)\r\n        this.msg.active = false;\r\n        // 球数显示\r\n        this.userInfo = cc.find(\"UI_ROOT/userInfo\")\r\n        this.ballNumLabel = cc.find(\"UI_ROOT/userInfo/ballNum\").getComponent(cc.Label)\r\n        // 砖块列表\r\n        this.levelBlockNode = cc.find(\"UI_ROOT/levelBlock\");\r\n\r\n\r\n\r\n        this.RigidBody = this.getComponent(cc.RigidBody);\r\n\r\n        this.setArea(this.areaPercent);\r\n\r\n\r\n    },\r\n\r\n    setSpeed(speedPercent) {\r\n        // var velocity = this.RigidBody.linearVelocity;\r\n        //\r\n        // velocity.x = 500 * speedPercent;\r\n        // velocity.y = 500 * speedPercent;\r\n\r\n        this.RigidBody.linearVelocity = cc.p(500 * speedPercent, 500 * speedPercent);\r\n\r\n    },\r\n    setArea(areaPercent) {\r\n\r\n        // 图形大小\r\n        this.node.width = 30 * areaPercent;\r\n        this.node.height = 30 * areaPercent;\r\n\r\n        // 刚体大小\r\n        var physicsCircle = this.getComponent(cc.PhysicsCircleCollider);\r\n        physicsCircle.radius = 15 * areaPercent;\r\n\r\n        physicsCircle.apply();\r\n\r\n    },\r\n\r\n    resetPosition() {\r\n        // 展示球数\r\n        this.ballNumLabel.string = 'x  '+ this.ballNum;\r\n\r\n        this.ballRun = false;\r\n        // 清除速度\r\n        this.setSpeed(0);\r\n\r\n        // 板的位置\r\n        var _x = this.baffle.x;\r\n\r\n        var _y = this.node.width / 2 - 460;\r\n\r\n        this.node.setPosition(cc.v2(_x, _y));\r\n\r\n        this.timeout.string = '3'\r\n        var num = 2;\r\n        this.msg.active = true;\r\n        this.schedule(function () {\r\n            this.timeout.string = '' + num;\r\n            num -= 1;\r\n        }.bind(this), 1, 3)\r\n        //3秒后发球\r\n        this.scheduleOnce(function () {\r\n            this.ballRun = true;\r\n            this.setSpeed(this.speedPercent);\r\n            this.msg.active = false;\r\n        }.bind(this), 3)\r\n    },\r\n    // 获取剩下砖块数\r\n    getBlockNum(){\r\n        var surplusBlock = this.levelBlockNode.childrenCount;\r\n        if(this.levelBlockNode.childrenCount == 0){\r\n            // 通关\r\n            this.gameMain.passLevel()\r\n        }\r\n        \r\n    },\r\n    start() {\r\n\r\n    },\r\n\r\n    update(dt) {\r\n        if (this.node.y < -600) {\r\n            this.ballNum -= 1;\r\n\r\n            if (this.ballNum >= 0) {\r\n                this.resetPosition();\r\n            } else {\r\n                // 球用完 游戏结束\r\n                this.node.active = false;\r\n                this.gameMain.gameOver()\r\n            }\r\n        }\r\n    },\r\n\r\n    // 刚体碰撞\r\n    // 只在两个碰撞体开始接触时被调用一次\r\n    onBeginContact: function (contact, selfCollider, otherCollider) {\r\n\r\n    },\r\n\r\n    // 只在两个碰撞体结束接触时被调用一次\r\n    onEndContact: function (contact, selfCollider, otherCollider) {\r\n        if (otherCollider.node.groupIndex === 3) {\r\n            if(this.attack >= otherCollider.node.getComponent(\"block\").defense){\r\n                otherCollider.node.destroy();\r\n                this.getBlockNum()\r\n            }else {\r\n                otherCollider.node.getComponent(\"block\").defense -= this.attack;\r\n            }\r\n        }\r\n    },\r\n\r\n    // 每次将要处理碰撞体接触逻辑时被调用\r\n    onPreSolve: function (contact, selfCollider, otherCollider) {\r\n    },\r\n\r\n    // 每次处理完碰撞体接触逻辑时被调用\r\n    onPostSolve: function (contact, selfCollider, otherCollider) {\r\n    },\r\n\r\n    //碰撞\r\n    onCollisionStay: function (other, self) {\r\n        if (this.attack === 1) {\r\n            return;\r\n        }\r\n        if (other.node.groupIndex === 3) {\r\n            if (this.attack > other.node.getComponent(\"block\").defense) {\r\n                other.node.destroy();\r\n            }\r\n        }\r\n    },\r\n\r\n\r\n    //************** 能力强化  球 ***********\r\n\r\n    attackGrow(num) {\r\n        this.attach += num;\r\n    },\r\n    speedGrow(percent) {\r\n        this.speedPercent += percent;\r\n    },\r\n    areaGrow(percent) {\r\n        this.areaPercent += percent;\r\n    }\r\n\r\n});\r\n"]}